# This reusable workflow accepts a list of hostnames to test along with files containing what paths to use for each hostname.
# This function will look for a file with the same name as the hostname with the .json extension. 
# For example, if you are testing site1.com you need the file ./testfiles/site1.com.json, the format for this file
# can be found here https://github.com/marketplace/actions/check-urls
name: Check URLs

on:
  workflow_call:
    inputs:
      webhook:
        required: true
        type: string
      hostnames:  # Should be json like array [ site1.com, site2.com ]
        required: true
        type: string
        
env:
  SLACK_WEBHOOK: ${{ inputs.webhook }}

jobs:
  check-urls:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        hostname: ${{ fromJson(inputs.hostnames) }}
    name: Checks URLs from JSON file
    steps:
      - name: Log the action path
        run: pwd
      - name: Checkout
        uses: actions/checkout@v2
      - name: Check URLs
        uses: bythepixel/urlchecker@v0.15.0
        with:
          hostname: ${{ matrix.hostname }}
          filename: ./github/workflows/test-files/${{ matrix.hostname }}.json # Had to hardcode this for now as github.action_path is empty due to this issue https://github.com/actions/runner/issues/2473
